function Sys.xor 0
push argument 0 
push argument 1 
push argument 0 
push argument 1 
not             
and             
pop temp 0
push argument 0 
not             
push argument 1 
and             
pop temp 1
push temp 0
push temp 1
or              
return

function Sys.shiftLeft 4
push argument 0
push argument 1
pop temp 0
pop temp 1

label Loop 
push temp 0
push constant 0
eq
if-goto END  
push temp 1
push temp 1
add 
pop temp 1
push temp 0
push constant 1
sub
pop temp 0
goto Loop 
label END 
push temp 1
return


function Sys.computeParity 2
    push constant 0
    pop temp 0
    
    push constant 0
    pop temp 1

label LOOP
    push temp 1
    push constant 14
    gt
    if-goto END_LOOP

    push constant 1
    push temp 1
    call Sys.shiftLeft 4
    pop temp 2

    push argument 0
    push temp 2
    and
    pop temp 3

    push temp 3
    push constant 0
    eq
    if-goto SKIP_XOR

    push temp 0
    push constant 1
    call Sys.xor 2
    pop temp 0

label SKIP_XOR
    push temp 1
    push constant 1
    add
    pop temp 1

    goto LOOP

label END_LOOP
    push temp 0
    return

function Sys.encode 2
    call Sys.computeParity 1
    push argument 0
    pop temp 0
    push temp 0
    push constant 32768
    and
    push constant 0
    eq
    if-goto SET_HIGH_BIT
    push temp 0
    push constant 32768
    not
    and
    pop temp 1
    push temp 1
    return

label SET_HIGH_BIT
    push temp 0
    push constant 32768
    or
    pop temp 1
    push temp 1
    return

function Sys.init 0
call Sys.encode 1

label WHILE
    goto WHILE